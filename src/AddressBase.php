<?php

namespace Dxw\CIDR;

class AddressBase
{
    /** @var string */
    private $address;

    public static function Make(string $address): \Dxw\Result\Result
    {
        // I hate to suppress warnings, but there's no other way to disable
        // warnings generated by inet_pton, and we are handling it
        $_address = @inet_pton($address);
        if ($_address === false) {
            return \Dxw\Result\Result::err('inet_pton error: unrecognised address');
        }

        return \Dxw\Result\Result::ok(new static($_address));
    }

    private function __construct(string $address)
    {
        $this->address = $address;
    }

    public function __toString(): string
    {
        $value = inet_ntop($this->address);

        // $value should never be false since the address gets parsed by
        // inet_pton() before being passed to the constructor
        if ($value === false) {
            throw new \ErrorException("inet_ntop error: return value was false");
        }
        return $value;
    }

    public function getBinary(): \phpseclib\Math\BigInteger
    {
        return new \phpseclib\Math\BigInteger($this->address, 256);
    }
}
